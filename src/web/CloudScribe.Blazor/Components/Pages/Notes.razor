@page "/notes"
@rendermode InteractiveServer
@attribute [Authorize]

<AuthorizeView>
    <Authorized>
        <MudContainer>

            <MudButton Variant="Variant.Filled"
                       Color="Color.Primary"
                       StartIcon="@Icons.Material.Filled.Add"
                       OnClick="@(() => OpenDialog(null))">
                Add note
            </MudButton>

            @if (_notes == null)
            {
                <MudProgressCircular Color="Color.Primary" Indeterminate="true"/>
            }
            else
            {
                <MudTable Items="@_notes.Items" Hover="true" Breakpoint="Breakpoint.Sm">
                    <HeaderContent>
                        <MudTh>Title</MudTh>
                        <MudTh>Content</MudTh>
                        <MudTh>Created</MudTh>
                        <MudTh>Actions</MudTh>
                    </HeaderContent>
                    <RowTemplate Context="note">
                        <MudTd DataLabel="Title">@note.Title</MudTd>
                        <MudTd DataLabel="Content">
                            @(note.Content.Length > 50 ? note.Content[..50] + "..." : note.Content)
                        </MudTd>
                        <MudTd DataLabel="Created">@note.CreatedUtc.ToLocalTime().ToString("g")</MudTd>
                        <MudTd>
                            <MudIconButton Icon="@Icons.Material.Filled.Edit" Color="Color.Primary"
                                           OnClick="@(() => OpenDialog(note))"/>
                            <MudIconButton Icon="@Icons.Material.Filled.Delete" Color="Color.Error"
                                           OnClick="@(() => DeleteNote(note.Id))"/>
                        </MudTd>
                    </RowTemplate>
                    <PagerContent>
                        <MudTablePager/>
                    </PagerContent>
                </MudTable>
            }

        </MudContainer>
    </Authorized>
    <NotAuthorized>
        <MudContainer Class="mt-8">
            <MudPaper Class="pa-8" Elevation="2">
                <MudStack Spacing="4" AlignItems="AlignItems.Center">
                    <MudIcon Icon="@Icons.Material.Filled.Lock" Size="Size.Large" Color="Color.Warning"/>
                    <MudText Typo="Typo.h5" Align="Align.Center">
                        Access for Authenticated Users Only
                    </MudText>
                    <MudText Typo="Typo.body1" Align="Align.Center" Color="Color.Secondary">
                        This page requires authentication. Please sign in to view your notes.
                    </MudText>
                    <MudButton Variant="Variant.Filled"
                               Color="Color.Primary"
                               StartIcon="@Icons.Material.Filled.Login"
                               Href="authentication/login"
                               Target="_top">
                        Sign In
                    </MudButton>
                </MudStack>
            </MudPaper>
        </MudContainer>
    </NotAuthorized>
</AuthorizeView>

